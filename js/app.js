(()=>{let e={PLAYER:{UPDATE:"a",OTHER_UPDATE:"s"},ROOM:{UPDATE:"c",OTHER_UPDATE:"v",GET_ROOMS:"g",GET_PLAYERS:"h",ADD:"j",REMOVE:"l",ENTER:"k",LEAVE:"e",GAME:{ENTER:"r",FEN:"t",MOVE:"y",SIT:"u",STAND:"o",START:"z",END:"i",UPDATE:"m",READY:"x"}},DISCONNECT:"disconnect",OTHER_CONNECT:"other_connect"},t=["H\xe0 Nội","Hồ Ch\xed Minh"],n={MAIN:1,GAME:2},o={WAIT:0,READY:1,NONE:2};function r(e,t){let n={};function o(t){e[t]=void 0,Object.defineProperty(e,t,{set:function(e){!function e(o){if("function"==typeof o){let r=o.name||"__";n[t]=n[t]||{},n[t][r]=n[t][r]||[],n[t][r].push(o)}else throw"value is not a function"}(e)}}),e.handle[t]=void 0,Object.defineProperty(e.handle,t,{get:function(){var e;return e=t,Object.freeze({fire(t){for(let o in n[e]){let r=n[e][o];for(let i in r)r[i](t)}},remove(t){let o=t.name||t||"__";delete n[e][o]},clear(){n[e]={}}})}})}return e.handle={add(e){for(let t in e)o(e[t])},listen(t,n){o(t),e[t]=n}},!function e(){for(let n in t)o(t[n])}(),e.handle}function i(t="http://localhost:3000",n,o=60){let i=["|",":"],l=new io(t,{transports:["websocket"],auth:{token:n}}),E,u,f={},O={},s=[],a=[],c={fps:o,me:f,room:O,rooms:s,players:a};function R(e,t){for(let n in e)if(e[n].id==t.id){e[n]=t;return}e.push(t)}return c.toPlayer=function(e){return{online:e[0],turn:e[1],roomId:e[2],id:e[3]}},c.toRoom=function(e){return{id:e[0]}},toO=(e,t)=>"string"!=typeof e?e:t(e.split(i[0])),toList=(e,t)=>{if(!e||"string"!=typeof e[0])return e;let n=[];for(let o in e){let r=e[o];n.push(toO(r,t))}return n},E=new r(c,["onBeforeEmit","onAfterEmit","onServerEmit","onError",]),!function e(t,n){for(let o in t){let r=t[o];if("object"==typeof r){e(r,o);continue}function i(e){E.onBeforeEmit.fire(),u?(E.onAfterEmit.fire(0),E.onError.fire({msg:"Thao t\xe1c qu\xe1 nhanh!"})):(u=!0,l.emit(r,e),setTimeout(function(){u=!1,E.onAfterEmit.fire(1)},c.fps))}E[r]||E.listen(r,c[r]||Function()),l.on(r,e=>{E[r].fire(e),E.onServerEmit.fire({data:e,key:r})}),Object.defineProperty(c,r,{get:function(){return function(e){i(e)}}})}}(e),c[e.PLAYER.UPDATE]=e=>{f=toO(e,c.toPlayer)},c[e.PLAYER.OTHER_UPDATE]=c[e.ROOM.ENTER]=e=>{R(a,toO(e,c.toPlayer))},c[e.ROOM.UPDATE]=e=>{O=toO(e,c.toRoom)},c[e.ROOM.OTHER_UPDATE]=e=>{R(s,toO(e,c.toRoom))},c[e.ROOM.GET_ROOMS]=e=>{s=toList(e,c.toRoom)},c[e.ROOM.GET_PLAYERS]=e=>{a=toList(e,c.toPlayer)},c[e.ROOM.LEAVE]=e=>{a=a.filter(t=>e!=t.id)},c[e.ROOM.ADD]=e=>{e=toO(e,c.toRoom),s.push(e)},c[e.ROOM.REMOVE]=e=>{s=s.filter(t=>e!=t.id)},c[e.DISCONNECT]=E.onError.fire,Object.defineProperties(c,{me:{get:function(){return f}},room:{get:function(){return O}},players:{get:function(){return a}},rooms:{get:function(){return s}}}),c}(()=>{let e={trigger:n,bind:o},t={};function n(e,n){for(let o in t[e])t[e][o](n)}function o(e,n){if("function"==typeof n)t[e]=t[e]||[],t[e].push(n);else throw`${n} is not a function`}function r(){Object.defineProperties(e,{trigger:{get:function(){return n}},bind:{get:function(){return o}}})}return e})();let l=prompt("Nhap id","admin"),E=new i("https://20.196.203.43:80",l);E.toPlayer=function(e){return{online:e[0],turn:e[1],ready:e[2],roomId:e[3],id:e[4]}},E.toRoom=function(e){return{id:e[0],type:e[1]}};let u,f,O,s,a;function c(e){u.orientation("r"==e?"red":"black"),R()}function R(){$(".square-2b8ce").click(function(){let t=$(this).data("square"),n=this.children[0],o=n?$(n).data("piece")[0]:null,r=f.turn();if(E.me.turn==r){if(r==o)O=t,s?.classList?.remove("selected"),s=this,s.classList.add("selected");else if(O){let i=`${O}${t}`;f.move(i)&&(f.undo(),E[e.ROOM.GAME.MOVE](i))}}})}let m=new Vue({el:"#app",data:{SCREEN:n,ROOMS:t,READY:o,me:null,screen:n.MAIN,room:{},game:{players:[null,null]},rooms:null,players:null},methods:{roomChange:E[e.ROOM.ENTER],roomAdd:E[e.ROOM.ADD],roomLeave:E[e.ROOM.LEAVE],gameEnter:E[e.ROOM.GAME.ENTER],gameSit:E[e.ROOM.GAME.SIT],gameStand:E[e.ROOM.GAME.STAND],gameReady:E[e.ROOM.GAME.READY]}});E[e.ROOM.UPDATE]=function(e){m.room=E.room,m.screen=E.room.type?n.MAIN:n.GAME},E[e.PLAYER.UPDATE]=function(e){m.me=E.me},E[e.ROOM.GAME.UPDATE]=function(e){m.game.players=[],m.game.players=e},E[e.ROOM.GAME.FEN]=function(e){u=new Xiangqiboard("board",e),f=new Xiangqi(e),"0"!=E.me.turn&&c(E.me.turn)},E[e.ROOM.GAME.MOVE]=function(e){let t=`${e[0]}${e[1]}`,n=`${e[2]}${e[3]}`;u.move(`${t}-${n}`),f.move(e),s?.classList?.remove("selected"),(s=document.querySelectorAll(`[data-square="${t}"]`)[0])?.classList?.add("selected"),a?.classList?.remove("selected"),(a=document.querySelectorAll(`[data-square="${n}"]`)[0])?.classList?.add("selected")},E[e.ROOM.OTHER_UPDATE]=E[e.ROOM.ADD]=E[e.ROOM.REMOVE]=E[e.ROOM.GET_ROOMS]=function(e){m.rooms=null,m.rooms=E.rooms},E[e.PLAYER.OTHER_UPDATE]=E[e.ROOM.ENTER]=E[e.ROOM.LEAVE]=E[e.ROOM.GET_PLAYERS]=function(e){m.players=null,m.players=E.players}})();
